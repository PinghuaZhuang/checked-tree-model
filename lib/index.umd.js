(function(a,r){typeof exports=="object"&&typeof module<"u"?module.exports=r():typeof define=="function"&&define.amd?define(r):(a=typeof globalThis<"u"?globalThis:a||self,a.TreeModel=r())})(this,function(){"use strict";function a(f,e,t,i){if(t==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?f!==e||!i:!e.has(f))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?i:t==="a"?i.call(f):i?i.value:e.get(f)}function r(f,e,t,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?f!==e||!s:!e.has(f))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(f,t):s?s.value=t:e.set(f,t),t}var n,h,l,c;let u={};function m(f,...e){e.forEach(t=>{var i;for(const s in t){const d=t[s];d!==null&&(typeof d!="object"?f[s]=d:(f[s]=(i=f[s])!==null&&i!==void 0?i:{},m(f[s],d)))}})}class o{constructor(e,t){n.set(this,!1),h.set(this,!1),l.set(this,!1),c.set(this,!1),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"pId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"level",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"childList",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"className",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"map",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.options=Object.assign({},e),this.name=e.name,this.className=e.className,this.id=e.id,this.pId=e.pId,this.parent=t,this.level=t==null?0:t.level+1,this.map=t==null?{[this.id]:this}:t.map,this.childList=e.childList.map(i=>{const s=new o(i,this);return this.map[s.id]=s,s})}isRoot(){return this.level===0}get checked(){return a(this,n,"f")}get indeterminate(){return a(this,l,"f")}diff(){let e=u[this.id];return a(this,h,"f")!==a(this,n,"f")&&(e=e!=null?e:{},e.checked=a(this,n,"f"),a(this,n,"f")&&(e.indeterminate=!1)),a(this,c,"f")!==a(this,l,"f")&&(e=e!=null?e:{},e.indeterminate=a(this,l,"f")),e&&(u[this.id]=e),e}setChecked(e,t){r(this,h,a(this,n,"f"),"f"),r(this,n,e,"f"),e&&this.setIndeterminate(!1,!0),this.diff()&&this.parent&&!t&&this.calcParentStatus(),e?this.each(i=>{i.setIndeterminate(!1,!0),i.setChecked(!0,!0)}):this.indeterminate||this.each(i=>{i.setIndeterminate(!1,!0),i.setChecked(!1,!0)})}setIndeterminate(e,t){r(this,c,a(this,l,"f"),"f"),r(this,l,e,"f"),e&&!t&&(r(this,h,a(this,n,"f"),"f"),r(this,n,!1,"f"),this.parent&&this.parent.setIndeterminate(!0)),t||this.diff()}setCheckedReturnDiff(e,t){u={};const i=this.map[e!=null?e:this.id];if(i==null)return{};i.setChecked(t!=null?t:!0);const s=Object.assign({},u);return u={},s}selectKeys(e){const t=this.clean();return e.forEach(i=>{m(t,this.setCheckedReturnDiff(i))}),t}getSelectKeys(){const e=[];return Object.values(this.map).forEach(t=>{t.checked&&e.push(t.id)}),e}calcParentStatus(){const{parent:e}=this;if(e==null)return;const{childList:t}=e,{length:i}=t;if(i<=0)return;r(e,h,a(e,n,"f"),"f"),r(e,c,a(e,l,"f"),"f");const s=t.filter(p=>p.checked).length;s===i?(r(e,n,!0,"f"),r(e,l,!1,"f")):s>0?(e.setIndeterminate(!0),r(e,n,!1,"f")):(r(e,l,!1,"f"),r(e,n,!1,"f")),e.diff()&&!e.indeterminate&&e.calcParentStatus()}clean(){const e={};return Object.values(this.map).forEach(t=>{let i=e[t.id];t.checked&&(i=i!=null?i:{},i.checked=!1),t.indeterminate&&(i=i!=null?i:{},i.indeterminate=!1),i&&(e[t.id]=i),r(t,h,r(t,n,!1,"f"),"f"),r(t,c,r(t,l,!1,"f"),"f")}),e}each(e){this.childList.forEach((t,i)=>{e(t,this,i)})}eachDeep(e){this.childList.forEach((t,i)=>{e(t,this,i),t.eachDeep(e)})}eachDeepAfter(e){this.childList.forEach((t,i)=>{t.eachDeep(e),e(t,this,i)})}}return n=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakMap,o});
